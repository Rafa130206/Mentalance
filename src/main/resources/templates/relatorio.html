<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org"
      th:replace="fragments/base :: layout(~{::title}, ~{::body})">
<head>
    <title th:text="#{report.title}">Relatório</title>
</head>
<body>
<section class="card">
    <h1 th:text="#{report.title}">Relatório</h1>
    <form th:action="@{/relatorio}" method="get" class="grid grid--2">
        <div>
            <label for="inicio" th:text="#{report.period} + ' (Início)'">Início</label>
            <input type="date" id="inicio" name="inicio" th:value="${inicio}">
        </div>
        <div>
            <label for="fim" th:text="#{report.period} + ' (Fim)'">Fim</label>
            <input type="date" id="fim" name="fim" th:value="${fim}">
        </div>
        <div>
            <button type="submit" th:text="#{report.filters}">Filtrar</button>
        </div>
    </form>
</section>

<section class="card">
    <h2 th:text="#{dashboard.weeklyReport}">Relatório semanal</h2>
    <canvas id="chartEvolucao"></canvas>
</section>

<section class="card">
    <h2 th:text="#{checkin.history}">Histórico</h2>
    <table>
        <thead>
        <tr>
            <th>Data</th>
            <th>Emoção</th>
            <th>Texto</th>
            <th>Sentimento</th>
            <th>Resposta</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="checkin : ${checkins}">
            <td th:text="${#temporals.format(checkin.dataCheckin, 'dd/MM/yyyy HH:mm')}">01/01/2025 14:30</td>
            <td th:text="${checkin.emocao}">Feliz</td>
            <td th:text="${checkin.texto}">Dia produtivo</td>
            <td th:text="${checkin.analiseSentimento}">positivo</td>
            <td th:text="${checkin.respostaGerada}">Resposta gerada</td>
        </tr>
        </tbody>
    </table>
</section>

<script th:inline="javascript">
    const checkins = /*[[${checkins}]]*/ [];
    const labels = checkins.map(c => {
        const date = new Date(c.dataCheckin);
        return date.toLocaleDateString('pt-BR');
    });
    
    // Contagem de emoções
    const emocaoCount = {};
    checkins.forEach(c => {
        emocaoCount[c.emocao] = (emocaoCount[c.emocao] || 0) + 1;
    });

    if (Object.keys(emocaoCount).length > 0) {
        const ctx = document.getElementById('chartEvolucao');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: Object.keys(emocaoCount),
                datasets: [{
                    label: 'Distribuição de Emoções',
                    data: Object.values(emocaoCount),
                    backgroundColor: ['#4F46E5', '#22D3EE', '#F97316', '#F43F5E', '#2DD4BF']
                }]
            }
        });
    }
</script>
</body>
</html>

